bind                                   cid              uid:39069102337167360
0000002d0c00000000000000000000000000000001010000000000113339303639313032333337313637333630
0000002d0c00000000000000000000000000000002010000000000113339303639313032333337313637333630

sendtoone                              cid
0000003f050000000000000000000000000000000101000000000000fffe000000000023000000000000000100010101ab564ace4d51b232d051029226b500

sendtouid
000000570e00000000000000000000000000000000010000000000155b223339303639313032333337313637333630225d7b22636d64223a32332c2264617461223a22303838306130383039383831656539393632227d
                                                            3339303639313032333337313637333630

joingroup                              cid              gid:54248935702663168 
0000002d1400000000000000000000000000000001010000000000113534323438393335373032363633313638
                                                        gid:38936001950781440
0000002d1400000000000000000000000000000002010000000000113338393336303031393530373831343430

sendtogroup                                                                                                 
0000008a16000000000000000000000000000000000100000000002e7b226578636c756465223a6e756c6c2c2267726f7570223a5b223534323438393335373032363633313638225d7d7b22636d64223a31372c2264617461223a223061313430383830613038306638633363653837353631303830613038306238656161656336363831383031227d
                                                                                                            3534323438393335373032363633313638
0000008a16000000000000000000000000000000000100000000002e7b226578636c756465223a6e756c6c2c2267726f7570223a5b223338393336303031393530373831343430225d7d7b22636d64223a31372c2264617461223a223061313430383830613038306638633363653837353631303830613038306238656161656336363831383031227d

getclientidbyuid
0000002d0f00000000000000000000000000000000010000000000113339303639313032333337313637333630

getgroupidlist 
0000001c1a0000000000000000000000000000000001000000000000

GetClientCountByGroup
                                                        gid:38936001950781440
0000002d1800000000000000000000000000000000000000000000113338393336303031393530373831343430

getclientsessionsbygid
                                                        gid:38936001950781440
0000002d1700000000000000000000000000000000010000000000113338393336303031393530373831343430

setclientsession
                                       cid              gid:38936001950781440
0000002dcc00000000000000000000000000000001010000000000113338393336303031393530373831343430
// 重置
0000001ccc0000000000000000000000000000000101000000000000

leavegroup
                                       cid              gid:38936001950781440
0000002d1500000000000000000000000000000002010000000000113338393336303031393530373831343430
0000002d1500000000000000000000000000000001010000000000113534323438393335373032363633313638

isOnline
                                       cid              
0000001c0b0000000000000000000000000000000101000000000000

closeclient
kick
                                       cid              
0000001d07000000000000000000000000000000010100000000000133
destroy
0000001c080000000000000000000000000000000201000000000000


select                                                                                                                                                                                      3534323438393335373032363633313638       
{"fields":["uid"],"where":{"uid":[],"connection_id":{},"groups":["54248935702663168"]}} 返回 {"3":{"uid":"39069102337167360"},"4":{"uid":"39069102337167360"}}
000000731900000000000000000000000000000000010000000000577b226669656c6473223a5b22756964225d2c227768657265223a7b22756964223a5b5d2c22636f6e6e656374696f6e5f6964223a7b7d2c2267726f757073223a5b223534323438393335373032363633313638225d7d7d

{"fields":["uid"],"where":{"connection_id":{"4":4}}}  返回 {"4":{"uid":"39069102337167360"}}
000000501900000000000000000000000000000000010000000000347b226669656c6473223a5b22756964225d2c227768657265223a7b22636f6e6e656374696f6e5f6964223a7b2234223a347d7d7d


后期完善重点：
上行收包进程异常退出的处理
上行收包 粘包分包的问题 处理逻辑复杂，后续要优化
下行收包 粘包分包的问题 已完成








龙哥提供的client.php生成的数据包调试记录：
binduid                              cid:1              uid:62205555455823872
0000002d0c00000000000000000000000000000001010000000000113632323035353535343535383233383732
0000002d0c00000000000000000000000000000100010000000000113632323035353535343535383233383732
joingroup                            cid:1              gid:122691596189171712
0000002e140000000000000000000000000000000101000000000012313232363931353936313839313731373132
0000002e140000000000000000000000000000010001000000000012313232363931353936313839313731373132

setsession                           cid:1              session:a:4:{s:2:"os";s:3:"ios";s:7:"version";s:5:"1.2.0";s:12:"build_number";s:2:"57";s:9:"device_id";s:36:"F2E37AD6-8086-4E19-AE4B-3F553CE0A6A5";}
000000a8cc000000000000000000000000000001000100000000008c613a343a7b733a323a226f73223b733a333a22696f73223b733a373a2276657273696f6e223b733a353a22312e322e30223b733a31323a226275696c645f6e756d626572223b733a323a223537223b733a393a226465766963655f6964223b733a33363a2246324533374144362d383038362d344531392d414534422d334635353343453041364135223b7d

GetClientCountByGroup
0000002e180000000000000000000000000000000001000000000012313232363931353936313839313731373132

getallclientcount    实际上是 GetClientCountByGroup 的 gid为空
0000001c180000000000000000000000000000000001000000000000

GetAllClientSession
0000001c0a0000000000000000000000000000000001000000000000

GetClientSessionsByGroup
0000002e170000000000000000000000000000000001000000000012313232363931353936313839313731373132

GetClientIdByUid    isUidOnline
0000002d0f00000000000000000000000000000000010000000000113632323035353535343535383233383732
GetClientIdsByUid   isUidsOnline
000000451000000000000000000000000000000000010000000000295b223632323035353535343535383233383732222c223632323035353535343535383233383733225d


GetSession
0000001ccb0000000000000000000000000000020001000000000000

sendtoall
0000002e060000000000000000000000000000000001000000000000e58f91e98081e58685e5aeb9e983a8e58886

sendtoone
0000002e050000000000000000000000000000000101000000000000e58f91e98081e58685e5aeb9e983a8e58886
0000002e050000000000000000000000000000010001000000000000e58f91e98081e58685e5aeb9e983a8e58886
sendtogroup
0000005d16000000000000000000000000000000000100000000002f7b2267726f7570223a5b22313232363931353936313839313731373132225d2c226578636c756465223a6e756c6c7de58f91e98081e58685e5aeb9e983a8e58886

sendtouid
000000430e00000000000000000000000000000000010000000000155b223632323035353535343535383233383732225de58f91e98081e58685e5aeb9e983a8e58886

updatesession   build_number字段的值从57改为56
000000a809000000000000000000000000000001000100000000008c613a343a7b733a323a226f73223b733a333a22696f73223b733a373a2276657273696f6e223b733a353a22312e322e30223b733a31323a226275696c645f6e756d626572223b733a323a223536223b733a393a226465766963655f6964223b733a33363a2246324533374144362d383038362d344531392d414534422d334635353343453041364135223b7d

leavegroup
0000002e150000000000000000000000000000000101000000000012313232363931353936313839313731373132

unbinduid
0000002d0d00000000000000000000000000000001010000000000113632323035353535343535383233383732

closeclient
0000001e0700000000000000000000000000000001000000000000004e3b



huhu  私信gid：53825030609440768   也是uid
hepeng 私信gid:92302787794178048   也是uid     发私信的时候是发sendtogroup，但是gid实际上是用的uid
d的社区 gid 98421291031203840



11万连接稳定状态下的各项指标：
ps auxf|grep gw
root       13266 28.6 17.2 83168652 1396088 pts/0 Sl+ 12:00   4:01  |       \_ ./gwrcv
root       13272  5.7  1.2 68163140 104408 pts/0 Sl+  12:00   0:48  |           \_ gwrcv --proc-id=1
root       13273  5.9  0.3 67361664 29264 pts/0  Rl+  12:00   0:49  |           \_ gwcliprc
root       13274  0.7  0.3 67357228 29612 pts/0  Sl+  12:00   0:06  |           \_ gwregister
root       13287  7.4  0.4 67453840 34536 pts/0  Rl+  12:00   1:02  |               \_ gwbwprc

按照启动时100M，到11W连接时1.3G，相当于11W连接增长了1.2G的内存，每个连接约11KB，有8kb是微线程自用，另外有1KB是接收缓存

## 内存占用情况  总内存8G， 大页2G：
### 大页内存
root@hepeng:~# cat /proc/meminfo |grep -i huge
AnonHugePages:         0 kB
ShmemHugePages:        0 kB
FileHugePages:         0 kB
HugePages_Total:    1024
HugePages_Free:       28
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
Hugetlb:         2097152 kB

### 其他内存
root@hepeng:~# free -m
               total        used        free      shared  buff/cache   available
Mem:            7901        4133         194           9        3573        3453
Swap:           4095           5        4090

## cpu使用情况 总共8C  只使用了4C  只有一个进程收包
Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
Average:     all    2.82    0.00    1.01    0.00    0.00    0.21    0.00    0.00    0.00   95.96
Average:       0   23.74    0.00    0.24    0.00    0.00    0.00    0.00    0.00    0.00   76.02
Average:       1    2.21    0.00    7.97    0.00    0.00    0.00    0.00    0.00    0.00   89.82
Average:       2    0.00    0.00    0.00    0.00    0.00    0.73    0.00    0.00    0.00   99.27
Average:       3    0.14    0.00    0.07    0.00    0.00    0.94    0.00    0.00    0.00   98.85
Average:       4    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
Average:       5    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
Average:       6    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
Average:       7    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00

## 流量统计  rx 3.4M  tx 2M   每个链接都只发送接收心跳包
|--------------------|--------------------|--------------------|--------------------|
|          rx packets|            rx bytes|          tx packets|            tx bytes|
|--------------------|--------------------|--------------------|--------------------|
|               32356|             3442882|               31713|             2093058|
|               26100|             2778238|               25362|             1673892|
|               15113|             1603520|               13896|              917136|
|               24960|             2662410|               24890|             1642740|
|               17970|             1905572|               16296|             1075536|
|               32308|             3444090|               31550|             2082300|
|               26071|             2773552|               25434|             1678644|
|               15234|             1617588|               13897|              917202|
|               24775|             2643668|               24906|             1643796|
单进程并发：8K