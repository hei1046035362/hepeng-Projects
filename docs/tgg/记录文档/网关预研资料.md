Gateworker存在的先天性能缺陷的点
一、不能绑核：
	1、线程在不同核之间的耗时问题(跨核切换带来的损耗)
	2、伪共享问题(可能存在大量缓存行同步，缓存行同步是微秒级，写缓存行是纳秒级)

原生支持的：c/c++,go,rust
需要通过第三方库或者其他手段实现的：java,python

二、内核协议栈问题
	主要是C10M的问题
	dpdk：
	   1、从网卡搬运数据到内存不需要cpu参与(通过dma)
	   2、没有内核态用户态之间的切换
	   3、pmd+无锁队列(无延时，硬中断的响应是微秒级)
	   4、cache miss问题(大页内存)
	   5、支持多队列网卡负载均衡
	   6、没有协议栈解包的漫长路径，更适合自定义



OpenIM:https://zhuanlan.zhihu.com/p/394077398
优势：sdk 客户端使用golang实现业务逻辑,支持的终端较为全面
缺陷点：
   本身比较笨重，包含server mq:kafka,redis,mongodb,mysql
   网络框架还是使用的内核协议栈

fstack
优点：freeBSD的协议栈+epoll+协程+nginx+redis，nginx底层网络支持dpdk
缺点：没有实现消息转发功能，只提供了连接请求、接收消息、发送消息的接口


seastar
优势：支持网络框架和存储框架，fstack性能上的优势seastar基本都具有
	避免了多个核心共享内存
	fstack没有自己的内存管理模块，seastar有
劣势：seastar和fstack对比：https://cloud.tencent.com/developer/article/1032602
	主要用于内网数据库，外网测试中，在传输较大文件或大并发小文件请求时，必现协议栈挂死完全无法访问的问题，外在表现是滑动窗口降为0。


有哪些开源的网关服务框架是用的dpdk的
Envoy
Mikrotik RouterOS
VPP (Vector Packet Processing)
Open vSwitch (OVS) with DPDK
Fast DPDK
Cilium
PicoTCP





1、dpdk需要预留大页，session也很耗内存，我们的性能瓶颈是在内存还是cpu?
2、网关、调度器、BW  这三个是在同一台设备吗？能帮我画一个框架的原理图不？
3、调度器的作用在咱们项目里的详细作用能在文档里面补充一下不？
4、nginx hash重构的问题，有没有试过使用dpdk的hash呢？
5、跨机房这部分主要是要做哪些事情？


维持原来的架构

1、gateway不宜承载过多的业务，所以dispatcher还是有必要的

2、dispatcher 承载的业务如果迁移到网关,虽然减少了一个网络节点，但是网关的内存节点增就增加了，带宽也可能会增加，且不利于横向扩展
           可以改进的点，把协议栈改成用户态？业务逻辑用C重写？
3、是做跨机房还是做主备？ 跨机房的功能是防止宕机还是要补全数据？

4、注册中心
维护网关的端口和进程 proc_id 的关系？
维护网关到后端业务的依赖关系？ 
	这里是调度器到后端的依赖关系还是网关到后端？网关和后端不是不直接联系了吗？这里建立关系是做什么用？
维护网关到转发调度器的依赖关系

如果f-stack没有使用dpdk，实际就相当于只用了nginx，为什么不直接用nginx就行了呢





网关入口侧 gwrcv 剩余问题汇总：
主动断开连接
配置文件
多进程处理

00000030050000000000000000000000000000016801000000000000 fffe000000000014000000000000000100010100
00000054190000000000000000000000000000000001000000000038 7b226669656c6473223a5b22756964225d2c227768657265223a7b22636f6e6e656374696f6e5f6964223a7b22333630223a3336307d7d7d




CmdProcessor.cpp:80行
        /// 1、考虑负载均衡  
        /// 2、要新增一个hash用来确定worker_key的唯一性
        /// 3、客户端绑定woker还没
        /// 4、进程退出要解绑的资源， woker对应的资源销毁，客户端连接绑定到新的woker